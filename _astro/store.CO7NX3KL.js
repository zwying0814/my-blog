import{$ as P,C as H,D as W,E as F,c as V}from"./web.ldtFZsFK.js";const N=Symbol("store-raw"),g=Symbol("store-node"),w=Symbol("store-has"),z=Symbol("store-self");function C(n){let e=n[P];if(!e&&(Object.defineProperty(n,P,{value:e=new Proxy(n,x)}),!Array.isArray(n))){const f=Object.keys(n),l=Object.getOwnPropertyDescriptors(n);for(let o=0,i=f.length;o<i;o++){const s=f[o];l[s].get&&Object.defineProperty(n,s,{enumerable:l[s].enumerable,get:l[s].get.bind(e)})}}return e}function b(n){let e;return n!=null&&typeof n=="object"&&(n[P]||!(e=Object.getPrototypeOf(n))||e===Object.prototype||Array.isArray(n))}function $(n,e=new Set){let f,l,o,i;if(f=n!=null&&n[N])return f;if(!b(n)||e.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):e.add(n);for(let s=0,d=n.length;s<d;s++)o=n[s],(l=$(o,e))!==o&&(n[s]=l)}else{Object.isFrozen(n)?n=Object.assign({},n):e.add(n);const s=Object.keys(n),d=Object.getOwnPropertyDescriptors(n);for(let t=0,c=s.length;t<c;t++)i=s[t],!d[i].get&&(o=n[i],(l=$(o,e))!==o&&(n[i]=l))}return n}function T(n,e){let f=n[e];return f||Object.defineProperty(n,e,{value:f=Object.create(null)}),f}function K(n,e,f){if(n[e])return n[e];const[l,o]=V(f,{equals:!1,internal:!0});return l.$=o,n[e]=l}function X(n,e){const f=Reflect.getOwnPropertyDescriptor(n,e);return!f||f.get||!f.configurable||e===P||e===g||(delete f.value,delete f.writable,f.get=()=>n[P][e]),f}function I(n){F()&&K(T(n,g),z)()}function Y(n){return I(n),Reflect.ownKeys(n)}const x={get(n,e,f){if(e===N)return n;if(e===P)return f;if(e===W)return I(n),f;const l=T(n,g),o=l[e];let i=o?o():n[e];if(e===g||e===w||e==="__proto__")return i;if(!o){const s=Object.getOwnPropertyDescriptor(n,e);F()&&(typeof i!="function"||n.hasOwnProperty(e))&&!(s&&s.get)&&(i=K(l,e,i)())}return b(i)?C(i):i},has(n,e){return e===N||e===P||e===W||e===g||e===w||e==="__proto__"?!0:(F()&&K(T(n,w),e)(),e in n)},set(){return!0},deleteProperty(){return!0},ownKeys:Y,getOwnPropertyDescriptor:X};function h(n,e,f,l=!1){if(!l&&n[e]===f)return;const o=n[e],i=n.length;f===void 0?(delete n[e],n[w]&&n[w][e]&&o!==void 0&&n[w][e].$()):(n[e]=f,n[w]&&n[w][e]&&o===void 0&&n[w][e].$());let s=T(n,g),d;if((d=K(s,e,o))&&d.$(()=>f),Array.isArray(n)&&n.length!==i){for(let t=n.length;t<i;t++)(d=s[t])&&d.$();(d=K(s,"length",i))&&d.$(n.length)}(d=s[z])&&d.$()}function L(n,e){const f=Object.keys(e);for(let l=0;l<f.length;l+=1){const o=f[l];h(n,o,e[o])}}function B(n,e){if(typeof e=="function"&&(e=e(n)),e=$(e),Array.isArray(e)){if(n===e)return;let f=0,l=e.length;for(;f<l;f++){const o=e[f];n[f]!==o&&h(n,f,o)}h(n,"length",l)}else L(n,e)}function _(n,e,f=[]){let l,o=n;if(e.length>1){l=e.shift();const s=typeof l,d=Array.isArray(n);if(Array.isArray(l)){for(let t=0;t<l.length;t++)_(n,[l[t]].concat(e),f);return}else if(d&&s==="function"){for(let t=0;t<n.length;t++)l(n[t],t)&&_(n,[t].concat(e),f);return}else if(d&&s==="object"){const{from:t=0,to:c=n.length-1,by:r=1}=l;for(let u=t;u<=c;u+=r)_(n,[u].concat(e),f);return}else if(e.length>1){_(n[l],e,[l].concat(f));return}o=n[l],f=[l].concat(f)}let i=e[0];typeof i=="function"&&(i=i(o,f),i===o)||l===void 0&&i==null||(i=$(i),l===void 0||b(o)&&b(i)&&!Array.isArray(i)?L(o,i):h(n,l,i))}function J(...[n,e]){const f=$(n||{}),l=Array.isArray(f),o=C(f);function i(...s){H(()=>{l&&s.length===1?B(f,s[0]):_(f,s)})}return[o,i]}const M=Symbol("store-root");function S(n,e,f,l,o){const i=e[f];if(n===i)return;const s=Array.isArray(n);if(f!==M&&(!b(n)||!b(i)||s!==Array.isArray(i)||o&&n[o]!==i[o])){h(e,f,n);return}if(s){if(n.length&&i.length&&(!l||o&&n[0]&&n[0][o]!=null)){let c,r,u,A,O,y,E,j;for(u=0,A=Math.min(i.length,n.length);u<A&&(i[u]===n[u]||o&&i[u]&&n[u]&&i[u][o]&&i[u][o]===n[u][o]);u++)S(n[u],i,u,l,o);const D=new Array(n.length),R=new Map;for(A=i.length-1,O=n.length-1;A>=u&&O>=u&&(i[A]===n[O]||o&&i[A]&&n[O]&&i[A][o]&&i[A][o]===n[O][o]);A--,O--)D[O]=i[A];if(u>O||u>A){for(r=u;r<=O;r++)h(i,r,n[r]);for(;r<n.length;r++)h(i,r,D[r]),S(n[r],i,r,l,o);i.length>n.length&&h(i,"length",n.length);return}for(E=new Array(O+1),r=O;r>=u;r--)y=n[r],j=o&&y?y[o]:y,c=R.get(j),E[r]=c===void 0?-1:c,R.set(j,r);for(c=u;c<=A;c++)y=i[c],j=o&&y?y[o]:y,r=R.get(j),r!==void 0&&r!==-1&&(D[r]=i[c],r=E[r],R.set(j,r));for(r=u;r<n.length;r++)r in D?(h(i,r,D[r]),S(n[r],i,r,l,o)):h(i,r,n[r])}else for(let c=0,r=n.length;c<r;c++)S(n[c],i,c,l,o);i.length>n.length&&h(i,"length",n.length);return}const d=Object.keys(n);for(let c=0,r=d.length;c<r;c++)S(n[d[c]],i,d[c],l,o);const t=Object.keys(i);for(let c=0,r=t.length;c<r;c++)n[t[c]]===void 0&&h(i,t[c],void 0)}function Q(n,e={}){const{merge:f,key:l="id"}=e,o=$(n);return i=>{if(!b(i)||!b(o))return o;const s=S(o,{[M]:i},M,f,l);return s===void 0?i:s}}const a=new WeakMap,q={get(n,e){if(e===N)return n;const f=n[e];let l;return b(f)?a.get(f)||(a.set(f,l=new Proxy(f,q)),l):f},set(n,e,f){return h(n,e,$(f)),!0},deleteProperty(n,e){return h(n,e,void 0,!0),!0}};function U(n){return e=>{if(b(e)){let f;(f=a.get(e))||a.set(e,f=new Proxy(e,q)),n(f)}return e}}export{J as c,U as p,Q as r};
